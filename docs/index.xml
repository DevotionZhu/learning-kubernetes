<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes 学习笔记</title>
    <link>/learning-kubernetes/</link>
      <atom:link href="/learning-kubernetes/index.xml" rel="self" type="application/rss+xml" />
    <description>Kubernetes 学习笔记</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh-Hans</language><copyright>roc © 2021</copyright><lastBuildDate>Tue, 02 Feb 2021 00:00:00 +0000</lastBuildDate>
    <image>
      <url>/learning-kubernetes/images/logo_hu42c222176c22e108a51ae6c5f8d90768_31178_300x300_fit_lanczos_2.png</url>
      <title>Kubernetes 学习笔记</title>
      <link>/learning-kubernetes/</link>
    </image>
    
    <item>
      <title>Sidecar Containers</title>
      <link>/learning-kubernetes/kep/sidecar-containers.html</link>
      <pubDate>Tue, 02 Feb 2021 00:00:00 +0000</pubDate>
      <guid>/learning-kubernetes/kep/sidecar-containers.html</guid>
      <description>&lt;h2 id=&#34;时间线&#34;&gt;时间线&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;2018-05: &lt;a href=&#34;https://github.com/Joseph-Irving&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Joseph Irving&lt;/a&gt; 发起 Sidecar Containers 的 &lt;a href=&#34;https://github.com/kubernetes/community/pull/2148&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KEP&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2018-11: KEP 被&lt;a href=&#34;https://github.com/kubernetes/community/pull/2148#issuecomment-442991599&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;接受&lt;/a&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2019-01: 新开 issue &lt;a href=&#34;https://github.com/kubernetes/enhancements/issues/753&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#753&lt;/a&gt; 来跟进这个特性的进展。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2020-10: 经过两年的设计与开发，社区意见出现分歧，最终宣布该 KEP 被废弃，见作者的 &lt;a href=&#34;https://github.com/kubernetes/enhancements/issues/753#issuecomment-713471597&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;评论&lt;/a&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2020-11: Tim Hockin 发起新 &lt;a href=&#34;https://docs.google.com/document/d/1Q3685Ic2WV7jPo9vpmirZL1zLVJU91zd3_p_aFDPcS0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proposal&lt;/a&gt; 草稿。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/document/d/1Drw9C_Ljpcr4X9UPLvms1fn8uMRnTfJLb-xipgX4C1M/edit#heading=h.1kqwby7migh2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar use cases/requirements&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/enhancements/pull/1980&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sidecar: Address all concerns raised&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;case&#34;&gt;case&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;istio issue: &lt;a href=&#34;https://github.com/istio/istio/issues/7136&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#7136&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;k8s issue: &lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/65502&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#65502&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;istio-场景&#34;&gt;istio 场景&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;pod 启动时，业务容器比 istio-proxy 先 ready
&lt;ol&gt;
&lt;li&gt;流量转发到业务容器，但 istio-proxy 还无法接受流量，导致流量异常；规避方法，在业务容器跑脚本延时启动进程，等 envoy ready (收到初始配置)再启动。&lt;/li&gt;
&lt;li&gt;容器化过渡的应用，业务容器启动时需要调用其它服务，如果失败就退出，没有重试逻辑，而当 envoy 启动更慢时，业务容器调用其它服务失败，导致 pod 启动失败，如此循环。规避方法：改造业务，在启动逻辑中加重试逻辑。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;pod 销毁时，业务容器处理 SIGTERM，在 graceful shutdown 逻辑中调用另外的服务通知清理，但 envoy 同时也接收了 SIGTERM，不再转发增量请求，导致调用失败。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;参考资料&#34;&gt;参考资料&lt;/h2&gt;
</description>
    </item>
    
  </channel>
</rss>
